---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/navigation/Navbar';
import { ProfileView } from '../components/profile/ProfileView.tsx';
import { ProfileService } from '../services/ProfileService';
import { LocationService } from '../services/location.service';
import type { ProfileDTO, LocationDTO } from '../types';

// userId is guaranteed to be set by middleware for protected routes
const userId = Astro.locals.userId as string;

// Fetch profile and locations data server-side to avoid hydration mismatch
const profileService = new ProfileService();
const locationService = new LocationService();

let profile: ProfileDTO | null = null;
let locations: LocationDTO[] = [];

try {
  profile = await profileService.getProfile(userId);
  locations = await locationService.getUserLocations(userId);
} catch (error) {
  console.error('[Profile.astro] Error fetching data:', error);
  // Continue with null/empty data - client will handle errors
}
---

<Layout title="Profil uÅ¼ytkownika" showHeader={false}>
  <Navbar client:load userId={userId} />
  <ProfileView client:load userId={userId} initialProfile={profile} initialLocations={locations} />
</Layout>
